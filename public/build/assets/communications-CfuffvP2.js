import{D as f}from"./call-BrDnqm_Z.js";import"./_commonjsHelpers-C4iS2aBk.js";let n,r;async function B(t){if(!t){alert("Error: No se ha proporcionado un ID de cliente.");return}const e=document.getElementById("start-call-btn"),d=document.getElementById("end-call-btn"),a=document.getElementById("close-btn"),u=document.getElementById("loading-title"),g=document.getElementById("call-in-progress-title");e.classList.add("hidden"),u.classList.add("hidden"),d.classList.remove("hidden"),g.classList.remove("hidden"),a.disabled=!0,o("Conectando...");try{const E=await(await fetch("/crm/services/twilio/token")).json();n=new f(E.token,{codecPreferences:["opus","pcmu"]}),n.on("error",s=>{console.error(s),o(`Error: ${s.message}`),i(),l()}),n.on("connect",()=>{o("En llamada"),p()}),n.on("disconnect",()=>{o("Llamada finalizada"),i(),a.disabled=!1});const I={params:{customerId:t}};n.connect(I)}catch(c){console.error("Error al iniciar la llamada:",c),o("Error de inicializaciÃ³n"),l()}}function y(){n&&n.disconnectAll(),l()}function o(t){const e=document.getElementById("call-status");e&&(e.textContent=t)}function p(){let t=0;const e=document.getElementById("call-duration");e&&(r=setInterval(()=>{t++;const d=Math.floor(t/60).toString().padStart(2,"0"),a=(t%60).toString().padStart(2,"0");e.textContent=`${d}:${a}`},1e3))}function i(){clearInterval(r)}function l(){document.getElementById("start-call-btn").classList.remove("hidden"),document.getElementById("loading-title").classList.remove("hidden"),document.getElementById("end-call-btn").classList.add("hidden"),document.getElementById("call-in-progress-title").classList.add("hidden"),document.getElementById("close-btn").disabled=!1,document.getElementById("call-duration").textContent="00:00"}function m(){const t=document.getElementById("start-call-btn"),e=document.getElementById("end-call-btn");t&&t.addEventListener("click",d=>{const a=d.currentTarget.dataset.customerId;B(a)}),e&&e.addEventListener("click",()=>{y()})}document.addEventListener("DOMContentLoaded",m);document.addEventListener("livewire:navigated",m);
